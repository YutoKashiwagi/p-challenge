## サードパーティクッキー、ファーストパーティクッキーの違い

- ファーストパーティクッキー
  - クッキーに関連づけられたドメインが、閲覧しているWebページと同じであるもの

- サードパーティクッキー
  - クッキーに関連づけられたドメインが、閲覧しているWebページと異なるもの

[参考](https://developer.mozilla.org/ja/docs/Web/HTTP/Cookies#third-party_cookies)
## サードパーティクッキーでどのようにユーザーの訪問履歴を把握しているか

あるサイト訪問時、クロスオリジンのリクエストで広告配信サーバーに
- ユーザー情報
- どの広告を見たか
などの情報を送信して記録をとる

別のサイトを訪問した時にも同様の操作が行われ、広告配信サーバーはクッキーを元にユーザー情報を識別し、ユーザーの行動履歴を元に適切な広告を決定する
これにより、あるサイトで冷蔵庫を見たら別のサイトでも冷蔵庫の広告が表示されたりする

https://xtrend.nikkei.com/atcl/contents/technology/00005/00012/

## どのようにサードパーティクッキーは生成されるか

- iframeを利用したもの
  - 埋め込み広告など、外部サービスから配布されたiframeをページに埋め込む
  - ユーザーがそのページを訪問した際、iframe内のscriptが実行され、トラッキング用のサーバーとcookieの送受信が行われる
- imgタグを利用したもの
  - 外侮サービスから配布された画像を使用しているページに訪問した際、imgタグ経由でサーバーとcookieの送受信が行われる


## ブラウザごとのサードパーティクッキーの取り扱い
- Safari
AppleがITP(Intelligent Tracking Prevention)というトラッキングの防止の取り組みを行っており、他のブラウザよりサードパーティクッキーの規制が厳しい。Safariが制限→広告会社が抜け道発見→抜け道を制限という流れが続いており、段階的に規制が進み、現在はデフォルトでサードパーティクッキーは完全にブロックされている

- Chrome
2022年を目処に、段階的にサードパーティクッキーを廃止する予定

## ポート番号について

ドメインが同一で、ポートが異なるクッキーはファーストパーティクッキーになる（ドメインが同一であればいいため）
